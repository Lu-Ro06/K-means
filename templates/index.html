<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Detección de Fraude K-means</title>

    <style>
        /* RESET */
        * { margin: 0; padding: 0; box-sizing: border-box; }

        /* PALETA AZUL · MORADO · NEGRO MATE */
        :root {
            --bg-main: #0b0d14;
            --bg-secondary: #111427;
            --bg-card: rgba(255,255,255,0.04);

            --blue: #5c7cfa;
            --purple: #9b7bff;

            --text-main: #e8ebff;
            --text-muted: #a0a6d8;

            --border-soft: rgba(255,255,255,0.12);
            --shadow-main: 0 10px 30px rgba(0,0,0,0.7);
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            background: radial-gradient(circle at top, #15193a, #07080f 70%);
            color: var(--text-main);
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Header */
        header {
            text-align: center;
            margin-bottom: 40px;
        }

        header h1 {
            color: var(--blue);
            margin-bottom: 10px;
        }

        header p {
            color: var(--text-muted);
        }

        /* Input de selección */
        .input-box {
            background: var(--bg-card);
            padding: 25px;
            border-radius: 15px;
            border: 2px solid var(--blue);
            text-align: center;
            margin-bottom: 30px;
            box-shadow: var(--shadow-main);
        }

        input[type="number"] {
            padding: 10px;
            border-radius: 6px;
            border: none;
            width: 80px;
            font-size: 1.1em;
            margin: 0 10px;
            background: #0f1224;
            color: var(--text-main);
        }

        button {
            padding: 10px 25px;
            background: linear-gradient(135deg, var(--blue), var(--purple));
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
        }

        button:hover {
            opacity: 0.9;
        }

        /* Gráficas */
        .plot-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .plot-card {
            background: var(--bg-card);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            box-shadow: var(--shadow-main);
        }

        .plot-card p {
            color: var(--text-muted);
        }

        .plot-card img {
            width: 100%;
            border-radius: 8px;
            border: 1px solid var(--border-soft);
            margin-top: 10px;
        }

        /* Clusters */
        h2 {
            margin-bottom: 20px;
            color: var(--purple);
        }

        .cluster-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .cluster-card {
            background: var(--bg-secondary);
            border-left: 4px solid var(--blue);
            padding: 20px;
            border-radius: 6px;
            box-shadow: var(--shadow-main);
        }

        .cluster-card strong {
            color: var(--text-main);
            font-size: 1.1em;
            display: block;
            margin-bottom: 5px;
        }

        .cluster-card p {
            font-size: 0.95em;
            color: var(--text-muted);
        }

        .fraud-text {
            color: var(--purple);
            font-weight: 500;
            margin-top: 5px;
        }

        /* Evaluación */
        .eval-section {
            background: var(--bg-card);
            padding: 30px;
            border-radius: 15px;
            border: 1px solid var(--border-soft);
            margin-top: 30px;
            box-shadow: var(--shadow-main);
        }

        .eval-title {
            color: var(--blue);
            font-size: 1.6em;
            margin-bottom: 25px;
            border-bottom: 1px solid rgba(92,124,250,.4);
            padding-bottom: 10px;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }

        .metric-card {
            border: 1px solid var(--purple);
            border-radius: 12px;
            padding: 35px 20px;
            text-align: center;
            background: rgba(155,123,255,.05);
        }

        .metric-label {
            color: var(--text-muted);
            font-size: 0.8em;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 15px;
        }

        .metric-value {
            color: var(--blue);
            font-size: 2.6em;
            font-weight: bold;
        }

        @media (max-width: 768px) {
            .plot-grid {
                grid-template-columns: 1fr;
            }

            .metrics-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <h1>Detección de Fraude K-means</h1>
            <p>Ajuste dinámico de clusters para análisis de transacciones</p>
        </header>

        <div class="input-box">
            <form method="POST">
                <label>Ingresa número de Clusters:</label>
                <input type="number" name="num_clusters" value="{{ current_k }}" min="2" max="15">
                <button type="submit">Procesar Modelo</button>
            </form>
        </div>

        <div class="plot-grid">
            <div class="plot-card">
                <p>Distribución de Variables</p>
                <img src="{{ url_for('static', filename='images/features_distribution.png') }}?v={{ range(1, 9999) | random }}">
            </div>
            <div class="plot-card">
                <p>Zonas de Decisión (K={{ current_k }})</p>
                <img src="{{ url_for('static', filename='images/kmeans_decision_boundaries.png') }}?v={{ range(1, 9999) | random }}">
            </div>
        </div>

        <h2>Agrupación de Transacciones</h2>
        <div class="cluster-grid">
            {% for cluster in clusters %}
            <div class="cluster-card">
                <strong>Cluster {{ cluster.label }}</strong>
                <p>Muestras: {{ "{:,}".format(cluster.total) }}</p>
                <p class="fraud-text">Fraudes: {{ cluster.malicious }}</p>
            </div>
            {% endfor %}
        </div>

        <div class="eval-section">
            <div class="eval-title">Evaluación del Modelo</div>
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-label">Purity</div>
                    <div class="metric-value">{{ metrics.purity }}</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Silhouette</div>
                    <div class="metric-value">{{ metrics.silhouette }}</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Calinski</div>
                    <div class="metric-value">{{ "{:,.0f}".format(metrics.calinski) }}</div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
